Extend the existing Discord bot (DeckForge) to support improved inventory management, card recycling, a multi-step trading system, and a web-based admin interface. Use discord.py and PostgreSQL via asyncpg. Bot prefix is `?`.

---

ğŸ¯ Scope

âœ… Inventory UX Overhaul

â€¢ Modify `?mycards` to group identical cards:â€¢ Format: `(x7) Falcon 9 (ID: 1)`
â€¢ Show up to 8 lines per page
â€¢ Use left/right reaction emojis to scroll pages

â€¢ Remove image previews from inventory display


---

âœ… Recycling System

â€¢ Replace `?recycle [instance_id]` with:?recycle [card_id] [amount]
â€¢ Bot checks user inventory for matching card ID and quantity
â€¢ If available, remove specified number of instances and credit user
â€¢ Add `recycled_at` timestamp to deleted cards (optional logging)


---

âœ… Trading System

ğŸ—ƒï¸ Database Tables

CREATE TABLE trades (
  trade_id UUID PRIMARY KEY,
  initiator_id BIGINT,
  responder_id BIGINT,
  status TEXT DEFAULT 'pending',
  started_at TIMESTAMP,
  finalized_at TIMESTAMP
);

CREATE TABLE trade_items (
  trade_id UUID REFERENCES trades(trade_id),
  user_id BIGINT,
  card_id INT,
  quantity INT
);

ğŸ› ï¸ Commands

Command	Description	
?requesttrade @user	Initiates trade session	
?accepttrade	Accepts trade request or confirms trade	
?tradeadd [card_id] [amount]	Adds cards to trade pool	
?traderemove [card_id] [amount]	Removes cards from trade pool	
?finalize	Final confirmation after both users accept	


ğŸ” Trade Flow

1. Player A: `?requesttrade @PlayerB`
2. Player B: `?accepttrade`
3. 5-minute trade window begins
4. Both players use `?tradeadd` / `?traderemove`
5. Both use `?accepttrade` â†’ bot asks â€œAre you sure?â€
6. Both use `?finalize` â†’ trade completes


â€¢ Bot displays trade pool visually after each change
â€¢ Cards are transferred between inventories on finalize
â€¢ Trade expires after 5 minutes if not finalized


---

ğŸŒ Web Admin Panel

ğŸ” Auth

â€¢ Admins log in via Discord OAuth
â€¢ Only approved Discord IDs can access panel


ğŸ› ï¸ Features

â€¢ View all cards
â€¢ Add/edit cards with the following fields:â€¢ Name
â€¢ Description
â€¢ Height
â€¢ Diameter
â€¢ Thrust
â€¢ Payload to LEO
â€¢ Reusability: Expendable / Partially Reusable / Fully Reusable
â€¢ Image upload



ğŸ—ƒï¸ Backend

â€¢ Store new fields in `cards` table:


ALTER TABLE cards ADD COLUMN height TEXT;
ALTER TABLE cards ADD COLUMN diameter TEXT;
ALTER TABLE cards ADD COLUMN thrust TEXT;
ALTER TABLE cards ADD COLUMN payload_leo TEXT;
ALTER TABLE cards ADD COLUMN reusability TEXT;

---

ğŸ” Validation & UX

â€¢ Validate card quantities before recycling or trading
â€¢ Prevent duplicate trades or expired sessions
â€¢ Ensure inventory pagination works with reactions
â€¢ Confirm admin-only access to web panel


---

ğŸ—‚ï¸ File-Level Tasks

â€¢ `db/migrations/0004_phase2.sql`: Add trade tables and card fields
â€¢ `cogs/inventory.py`: Update `?mycards`, `?recycle`
â€¢ `cogs/trading.py`: Implement trade flow
â€¢ `web/admin_panel.py`: Flask or FastAPI app with Discord OAuth
â€¢ `tests/test_trading.py`: Validate trade logic and edge cases